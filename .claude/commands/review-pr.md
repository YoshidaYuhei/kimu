---
description: GitHub PRをレビューする
---

GitHub Pull Requestを包括的にレビューします。以下の手順に従ってください：

1. **PR情報の取得**:
   - コマンド引数としてPR番号が渡された場合は、それを使用
   - 渡されていない場合は、PR番号を尋ねる
   - `gh pr view [番号] --json title,body,files,additions,deletions,author,isDraft,labels`でPR情報を取得
   - `gh pr diff [番号]`で変更内容を取得
   - PRが存在しない場合は、エラーを表示して終了

2. **関連ADRの確認**:
   - PR説明文やコミットメッセージから関連するADR番号を検索
   - 関連ADRがあれば読み込み、設計決定に沿っているか確認の準備
   - ADRへの参照がない場合でも、`docs/adr/`から関連しそうなADRを探す

3. **レビュー方針の確認**:
   AskUserQuestionツールを使用して、以下を確認：

   - **レビューの深さ**: クイックレビュー、標準レビュー、詳細レビュー
   - **重点領域**: コード品質、パフォーマンス、セキュリティ、アクセシビリティ、テスト、型安全性
   - **フィードバック方法**: レポート表示のみ、またはGitHubにコメント投稿
   - **ブロッキング問題の扱い**: 重大な問題があった場合の対応

4. **コードレビューの実行**:
   以下の観点でレビューを実施：

   **設計とアーキテクチャ**:
   - ADRの設計決定に準拠しているか
   - 適切なコンポーネント設計（単一責任、関心の分離）
   - コードの再利用性と保守性
   - 適切な抽象化レベル

   **TypeScript/React固有**:
   - 型安全性：anyの使用、適切な型定義
   - React Hooksの正しい使用（依存配列、useEffect/useLayoutEffect等）
   - 不要な再レンダリングの防止（useMemo、useCallback、React.memo）
   - PropTypesではなくTypeScriptの型を使用
   - コンポーネントの適切な分割

   **コード品質**:
   - 可読性：命名規則、コメント、コードの明確さ
   - 複雑度：過度に複雑な関数やコンポーネント
   - DRY原則：重複コードの有無
   - エラーハンドリング：適切なエラー処理
   - エッジケースの考慮

   **パフォーマンス**:
   - 不要な計算の回避
   - 大きなリストの仮想化
   - 画像の最適化（lazy loading等）
   - バンドルサイズへの影響

   **セキュリティ**:
   - XSS脆弱性（dangerouslySetInnerHTML等）
   - 機密情報の漏洩（ハードコードされたAPIキー等）
   - 入力値の適切なバリデーション

   **アクセシビリティ**:
   - セマンティックHTML
   - ARIA属性の適切な使用
   - キーボードナビゲーション
   - スクリーンリーダー対応

   **テスト**:
   - テストカバレッジ：新規コードに対するテストの有無
   - テストの品質：適切なテストケース、わかりやすいテスト名
   - モックの適切な使用

   **スタイルとベストプラクティス**:
   - プロジェクトのコーディング規約に準拠
   - ESLintルールの遵守
   - 一貫性のあるコードスタイル

5. **レビュー結果の整理**:
   発見した問題を以下のカテゴリで分類：

   - **Critical（重大）**: セキュリティ問題、機能の破壊、重大なバグ
   - **Major（重要）**: パフォーマンス問題、設計上の問題、保守性の問題
   - **Minor（軽微）**: スタイルの問題、小さなリファクタリングの提案
   - **Suggestion（提案）**: より良い実装方法の提案、学習のためのコメント

6. **フィードバックの提供**:

   **レポート形式**（表示のみの場合）:
   ```markdown
   # PR #[番号] レビュー結果

   ## 概要
   - タイトル: [PRタイトル]
   - 変更: +[追加行数] -[削除行数]
   - ファイル数: [変更ファイル数]

   ## 総合評価
   [全体的な評価とコメント]

   ## Critical Issues（重大な問題）
   [問題の詳細]

   ## Major Issues（重要な問題）
   [問題の詳細]

   ## Minor Issues（軽微な問題）
   [問題の詳細]

   ## Suggestions（提案）
   [改善提案]

   ## Good Points（良い点）
   [良い実装や工夫を評価]

   ## 結論
   - [ ] Approve（承認）
   - [ ] Request Changes（変更要求）
   - [ ] Comment（コメント）
   ```

   **GitHubコメント投稿**（ユーザーが希望した場合）:
   - `gh pr review [番号] --comment --body "[レビューコメント]"`
   - または重大な問題がある場合: `gh pr review [番号] --request-changes --body "[レビューコメント]"`
   - または問題がない場合: `gh pr review [番号] --approve --body "[レビューコメント]"`

7. **エッジケースへの対応**:
   - GitHub CLIが認証されていない場合は、認証を促す
   - PRがドラフトの場合は、その旨を通知
   - 変更が非常に大きい場合（500行以上）は、ユーザーに重点領域を確認
   - 関連するテストが見つからない場合は指摘

8. **レビュー後のアクション提案**:
   - 重大な問題が見つかった場合：修正方法の具体的な提案
   - テストが不足している場合：`/testcode`コマンドの使用を提案
   - 設計上の問題がある場合：ADRの見直しや新規作成を提案

プロセス全体を通して、建設的で具体的なフィードバックを提供し、コードの品質向上を支援することを心がけてください。批判だけでなく、良い点も積極的に評価してください。
