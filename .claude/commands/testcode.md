---
description: ADRから実装に対するテストコードを生成する
---

ADR（Architecture Decision Record）の内容を元に、実装に対するテストコードを生成します。以下の手順に従ってください：

1. **ADRファイルの特定**:
   - コマンド引数としてADR番号またはファイルパスが渡された場合は、それを使用
   - 渡されていない場合は、`docs/adr/`ディレクトリ内のADRファイル一覧を表示し、ユーザーに選択させる
   - ADRファイルが存在しない場合は、エラーを表示して終了

2. **ADR内容の分析**:
   - ADRファイルを読み込み、以下を抽出・理解する：
     - 決定内容：何を実装するのか
     - 利点：期待される振る舞い
     - 制約・トレードオフ：エッジケース
     - 影響範囲：テスト対象のコンポーネント

3. **テスト方針の確認**:
   AskUserQuestionツールを使用して、以下を確認：

   - **テスト種別**: 単体テスト（Jest）、E2Eテスト（Playwright/Cypress）のいずれか（または両方）
   - **E2Eテストフレームワーク**: Playwright または Cypress（プロジェクトで使用しているもの）
   - **テスト対象**: 具体的にどのコンポーネント/フック/ユーティリティをテストするか
   - **重要なシナリオ**: ADRに基づいて特に重要なテストシナリオは何か

4. **テストコードの生成**:
   収集した情報を元に、テストコードを生成：

   **Jestによる単体テスト**:
   - **正常系テスト**: 基本的な機能が正しく動作することを確認
   - **異常系テスト**: エラーケースや境界値を確認
   - **コンポーネントテスト**: React Testing Libraryを使用したコンポーネントの振る舞い検証
   - **フック/ユーティリティテスト**: カスタムフックやユーティリティ関数のロジック検証

   **E2Eテスト**:
   - **ユーザーシナリオテスト**: 実際のユーザー操作フローを検証
   - **統合テスト**: 複数のコンポーネントやページの連携を検証
   - **クリティカルパステスト**: ADRで定義された重要な機能の動作確認

   テストコードには以下を含める：
   - TypeScriptの型定義
   - わかりやすいテスト名（describeとitブロック）
   - 適切なセットアップとクリーンアップ
   - 明確なアサーション（expect文）
   - ADRへの参照コメント（どのADRに基づくテストか）
   - モック/スタブの適切な使用

5. **テストファイルの保存**:
   - プロジェクトのテストディレクトリ構造に従ってファイルを配置
   - Jestテスト: 対象ファイルと同じディレクトリまたは`__tests__`ディレクトリ
     - 例: `src/components/Button.tsx` → `src/components/Button.test.tsx`
   - E2Eテスト: `e2e/`、`tests/e2e/`、または`cypress/e2e/`ディレクトリ
     - 例: `e2e/user-authentication.spec.ts`
   - ファイル作成後、パスとテスト実行方法をユーザーに表示

6. **エッジケースへの対応**:
   - テストディレクトリが存在しない場合は作成を提案
   - 既存のテストファイルがある場合は、追加するか上書きするか確認
   - ADRで言及されているコンポーネントが実装されていない場合は、テストをスキップ（test.skip）にする
   - 必要な依存関係（@testing-library/react, @testing-library/jest-dom等）が不足している場合は通知

7. **テスト実行の提案**:
   - Jestテスト: `npm test` または `npm run test:unit`
   - E2Eテスト: `npm run test:e2e` または `npx playwright test` / `npx cypress run`
   - テストコード生成後、実行コマンドを提示
   - 必要に応じてテストを実行し、結果を確認

8. **依存関係の事前チェック**:
   テストコード生成前に以下を確認：

   - Jest設定ファイル（jest.config.js）の存在
   - 必要なテストライブラリのインストール確認：
     - @testing-library/react-native
     - @testing-library/jest-dom (必要に応じて)
     - jest-environment-jsdom (必要に応じて)

   不足している場合は、インストールコマンドを提示し、ユーザーの承認を得てからインストール。

プロセス全体を通して、ADRの決定内容を正確に反映したテストコードを生成し、TypeScriptの型安全性を活かしたテストを心がけてください。
